{"version":3,"file":"pan.js","sources":["../../src/test-support/pan.js"],"sourcesContent":["import { settled, getRootElement } from '@ember/test-helpers';\nimport createPointerEvent from './create-pointer-event.js';\n\nfunction timeout(duration) {\n  return new Promise((resolve) => {\n    setTimeout(() => resolve(), duration);\n  });\n}\n\nfunction nextTickPromise() {\n  return new Promise((resolve) => {\n    setTimeout(resolve);\n  });\n}\n\nfunction getElement(target) {\n  if (\n    target.nodeType === Node.ELEMENT_NODE ||\n    target.nodeType === Node.DOCUMENT_NODE ||\n    target instanceof Window\n  ) {\n    return target;\n  } else if (typeof target === 'string') {\n    let rootElement = getRootElement();\n\n    return rootElement.querySelector(target);\n  } else {\n    throw new Error('Must use an element or a selector string');\n  }\n}\n\nfunction sendEvent(element, type, x, y, pointerType) {\n  const event = createPointerEvent(element, type, x, y, 0, pointerType);\n  element.dispatchEvent(event);\n}\n\nasync function _pan(element, options = {}) {\n  const { top, left, width, height } = element.getBoundingClientRect();\n\n  const {\n    direction = 'right',\n    duration = 300,\n    resolution = 17, // ms per step\n    pointerType,\n  } = options;\n\n  const right = left + width;\n  const bottom = top + height;\n\n  const middleX = left + width / 2;\n  const middleY = top + height / 2;\n\n  const {\n    startX = direction === 'left'\n      ? right - 1\n      : direction === 'right' || direction === 'up-right'\n        ? left + 1\n        : middleX,\n    endX = direction === 'left'\n      ? left + 1\n      : direction === 'right' || direction === 'up-right'\n        ? right - 1\n        : middleX,\n    startY = direction === 'up' || direction === 'up-right'\n      ? bottom - 1\n      : direction === 'down'\n        ? top + 1\n        : middleY,\n    endY = direction === 'up' || direction === 'up-right'\n      ? top + 1\n      : direction === 'down'\n        ? bottom - 1\n        : middleY,\n  } = options;\n\n  const steps = Math.ceil(duration / resolution);\n\n  sendEvent(document, 'pointerdown', startX, startY, pointerType);\n  sendEvent(element, 'pointerdown', startX, startY, pointerType);\n  for (let i = 1; i < steps; i++) {\n    await timeout(resolution);\n    const x =\n      direction === 'left'\n        ? startX - ((startX - endX) / steps) * i\n        : direction === 'right' || direction === 'up-right'\n          ? startX + ((endX - startX) / steps) * i\n          : middleX;\n    const y =\n      direction === 'up' || direction === 'up-right'\n        ? startY - ((startY - endY) / steps) * i\n        : direction === 'down'\n          ? startY + ((endY - startY) / steps) * i\n          : middleY;\n\n    sendEvent(document, 'pointermove', x, y, pointerType);\n    sendEvent(element, 'pointermove', x, y, pointerType);\n  }\n  sendEvent(document, 'pointerup', endX, endY, pointerType);\n  sendEvent(element, 'pointerup', endX, endY, pointerType);\n}\n\nexport default async function pan(target, direction, pointerType) {\n  await nextTickPromise();\n\n  if (!target) {\n    throw new Error('Must pass an element or selector to `pan`.');\n  }\n\n  let element = getElement(target);\n  if (!element) {\n    throw new Error(`Element not found when calling \\`pan('${target}')\\`.`);\n  }\n\n  await _pan(element, { direction, pointerType });\n\n  return settled();\n}\n"],"names":["timeout","duration","Promise","resolve","setTimeout","nextTickPromise","getElement","target","nodeType","Node","ELEMENT_NODE","DOCUMENT_NODE","Window","rootElement","getRootElement","querySelector","Error","sendEvent","element","type","x","y","pointerType","event","createPointerEvent","dispatchEvent","_pan","options","top","left","width","height","getBoundingClientRect","direction","resolution","right","bottom","middleX","middleY","startX","endX","startY","endY","steps","Math","ceil","document","i","pan","settled"],"mappings":"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"}